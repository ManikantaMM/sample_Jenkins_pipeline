
pipeline{
    agent any
    stages {
        stage('Setup') {
            steps {
                script {
                    // Check if the virtual environment exists
                    if (!fileExists('venv')) {
                        // Create and activate a virtual environment
                        sh 'python3 -m venv venv'
                        
                        // Activate the virtual environment
                        sh 'source venv/bin/activate'
                        
                        // Upgrade pip in the virtual environment
                        sh 'pip install --upgrade pip'
                        
                        // Install initial dependencies using pip
                        sh 'pip install boto3'
                    }// else {
                        // Activate the existing virtual environment
                       // sh 'source venv/bin/activate'
                    //}
                    
                    // Install additional dependencies (e.g., a new module)
                    //sh 'pip install new_module'
                }
            }
        }
        stage('trail'){
            steps{
                script{
                    sh 'echo "Current working directory $(pwd)"'
                    sh 'python3 --version'
                    sh 'python3 amis_in_between_specified_dates.py 2023-11-01 2023-11-30'
                }
            }

        }
        stage('Cleanup') {
            steps {
                script {
                    // Deactivate the virtual environment
                    sh 'deactivate'
                }
            }
        }
    }
}

